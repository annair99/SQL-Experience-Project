ANUSHKA NAIR:1601222

set echo on;
set linesize 200;
set pagesize 1000;
set heading on;

--Part 2
--1
SELECT FL_FLIGHT_NO, FL_ORIG, FL_DEST 
FROM flight 
JOIN airport ON FL_ORIG=AIR_CODE
WHERE AIR_HUB_AIRLINE IS NULL;

--2
SELECT TIC_FLIGHT_NO, COUNT(TIC_FLIGHT_NO) AS "Number of Tickets"
FROM ticket
JOIN flight on TIC_FLIGHT_NO=FL_FLIGHT_NO
WHERE FL_ORIG IN ('LAX','SFO') OR FL_DEST IN ('LAX','SFO')
GROUP BY TIC_FLIGHT_NO;

--3
SELECT DEP_FLIGHT_NO, DEP_DEP_DATE,EQ_EQUIP_TYPE from departures
JOIN EQUIP_TYPE ON EQ_EQUIP_NO=DEP_EQUIP_NO
WHERE EQ_EQUIP_TYPE NOT LIKE 'BOE%'
ORDER BY DEP_DEP_DATE,DEP_FLIGHT_NO;

--5
SELECT PAS_NAME FROM PASSENGER MINUS SELECT RES_NAME FROM RESERVATION;

--6

SELECT PIL_PILOTNAME, PIL_FLIGHT_PAY AS "Compensation", COUNT(PIL_PILOTNAME) AS "Number of flights" FROM pilots
JOIN DEPARTURES ON DEP_PILOT_ID = PIL_PILOT_ID
WHERE DEP_DEP_DATE LIKE '%APR-17%'
GROUP BY PIL_PILOTNAME, PIL_FLIGHT_PAY, PIL_PILOTNAME;

--9

SELECT FL_ORIG AS "Departs From", FL_DEST AS "Arrives at", MAX(FL_FARE) AS "Maximum Fare"
FROM flight GROUP BY FL_ORIG, FL_DEST;
    
--10

SELECT FL_FLIGHT_NO, FL_ORIG, FL_DEST, FL_ORIG_TIME AS "Departure Time" , FL_DEST_TIME AS "Arrival Time" 
FROM flight JOIN DEPARTURES ON DEP_FLIGHT_NO = FL_FLIGHT_NO
WHERE DEP_DEP_DATE NOT LIKE '%18-APR-17%'
ORDER BY FL_FLIGHT_NO;

--11

SELECT TIC_FLIGHT_NO, COUNT(TIC_FLIGHT_NO) AS "Number of Passengers"
FROM TICKET
HAVING COUNT(TIC_FLIGHT_NO)>5
GROUP BY TIC_FLIGHT_NO;

--12

SELECT DISTINCT EQ_EQUIP_TYPE, (EQ_FUEL_CAPACITY*EQ_MILES_PER_GAL) AS "Maximum Distance Flown"
FROM EQUIP_TYPE;

--13
SELECT PIL_PILOTNAME FROM pilots 
WHERE PIL_PILOTNAME NOT IN
(SELECT DISTINCT PIL_PILOTNAME FROM pilots
JOIN DEPARTURES on DEP_PILOT_ID=PIL_PILOT_ID 
WHERE DEP_DEP_DATE BETWEEN '01-APR-17' AND '30-APR-17');

--14

SELECT PAS_NAME AS "Passenger", RES_NAME AS "Person Making Reservation" 
FROM PASSENGER JOIN RESERVATION ON PAS_CONFIRM_NO = RES_CONFIRM_NO;

--15

SELECT FL_FLIGHT_NO, FL_ORIG, FL_DEST FROM flight
JOIN RESERVATION ON FL_FLIGHT_NO = RES_FLIGHT_NO
WHERE RES_NAME LIKE 'Ole Olson%'
ORDER BY FL_FLIGHT_NO;


--EXTRACREDIT

--3
SELECT PIL_PILOTNAME, PIL_STATE, PIL_FLIGHT_PAY, 
((SELECT AVG(PIL_FLIGHT_PAY) 
FROM pilots y WHERE x.PIL_STATE = y.PIL_STATE)) AS "Average State Pay" FROM pilots x
WHERE x.PIL_FLIGHT_PAY > (SELECT AVG(PIL_FLIGHT_PAY) FROM pilots y WHERE x.PIL_STATE = y.PIL_STATE)
GROUP BY PIL_PILOTNAME , PIL_STATE, PIL_FLIGHT_PAY;

--4

SELECT DISTINCT DEP_FLIGHT_NO, DEP_EQUIP_NO 
FROM DEPARTURES
JOIN flight ON DEP_FLIGHT_NO = FL_FLIGHT_NO
WHERE FL_ORIG IN
(SELECT AIR_CODE FROM airport 
    WHERE AIR_ELEVATION IN 
    (SELECT MAX(AIR_ELEVATION) 
        FROM airport) 
    OR AIR_ELEVATION IN
    (SELECT MIN(AIR_ELEVATION) 
        FROM airport)
);


--6

SELECT TIC_ITINERARY_NO, TIC_FLIGHT_NO, TIC_FLIGHT_DATE, PAS_NAME, PAS_ITINERARY_NO, PAS_FARE, PAS_CONFIRM_NO FROM TICKET
JOIN PASSENGER ON PAS_ITINERARY_NO = TIC_ITINERARY_NO
GROUP BY TIC_ITINERARY_NO, TIC_FLIGHT_NO, TIC_FLIGHT_DATE, PAS_NAME, PAS_ITINERARY_NO, PAS_FARE, PAS_CONFIRM_NO
HAVING (COUNT(TIC_ITINERARY_NO)=1);


--9

SELECT DISTINCT P1.PIL_PILOTNAME AS "Pilots" 
FROM pilots P1
JOIN pilots P2 
ON p1.PIL_PILOT_ID<>P2.PIL_PILOT_ID
JOIN departures
ON DEP_PILOT_ID=P1.PIL_PILOT_ID
ORDER BY P1.PIL_PILOTNAME;

--15

SELECT FL_FLIGHT_NO, FL_ORIG, FL_DEST, 
TO_CHAR(FL_ORIG_TIME, 'Month dd, yyyy, HH24:MI AM') AS "Departure Time", 
TO_CHAR(FL_DEST_TIME, 'Month dd, yyyy, HH24:MI AM') AS "Arrival Time"
FROM flight
ORDER BY FL_FLIGHT_NO;



 